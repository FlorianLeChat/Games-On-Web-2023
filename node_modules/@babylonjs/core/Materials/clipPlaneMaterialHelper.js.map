{"version":3,"file":"clipPlaneMaterialHelper.js","sourceRoot":"","sources":["../../../../lts/core/generated/Materials/clipPlaneMaterialHelper.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Effect } from \"./effect\";\r\nimport type { IClipPlanesHolder } from \"../Misc/interfaces/iClipPlanesHolder\";\r\nimport type { Nullable } from \"../types\";\r\nimport type { Plane } from \"../Maths/math.plane\";\r\n\r\n/** @internal */\r\nexport function addClipPlaneUniforms(uniforms: string[]): void {\r\n    if (uniforms.indexOf(\"vClipPlane\") === -1) {\r\n        uniforms.push(\"vClipPlane\");\r\n    }\r\n    if (uniforms.indexOf(\"vClipPlane2\") === -1) {\r\n        uniforms.push(\"vClipPlane2\");\r\n    }\r\n    if (uniforms.indexOf(\"vClipPlane3\") === -1) {\r\n        uniforms.push(\"vClipPlane3\");\r\n    }\r\n    if (uniforms.indexOf(\"vClipPlane4\") === -1) {\r\n        uniforms.push(\"vClipPlane4\");\r\n    }\r\n    if (uniforms.indexOf(\"vClipPlane5\") === -1) {\r\n        uniforms.push(\"vClipPlane5\");\r\n    }\r\n    if (uniforms.indexOf(\"vClipPlane6\") === -1) {\r\n        uniforms.push(\"vClipPlane6\");\r\n    }\r\n}\r\n\r\n/** @internal */\r\nexport function prepareDefinesForClipPlanes(primaryHolder: IClipPlanesHolder, secondaryHolder: IClipPlanesHolder, defines: string[] | Record<string, any>): boolean {\r\n    let changed = false;\r\n    let clipPlane = primaryHolder.clipPlane ?? secondaryHolder.clipPlane;\r\n    changed = addDefine(clipPlane, defines, \"CLIPPLANE\", \"#define CLIPPLANE\") || changed;\r\n    clipPlane = primaryHolder.clipPlane2 ?? secondaryHolder.clipPlane2;\r\n    changed = addDefine(clipPlane, defines, \"CLIPPLANE2\", \"#define CLIPPLANE2\") || changed;\r\n    clipPlane = primaryHolder.clipPlane3 ?? secondaryHolder.clipPlane3;\r\n    changed = addDefine(clipPlane, defines, \"CLIPPLANE3\", \"#define CLIPPLANE3\") || changed;\r\n    clipPlane = primaryHolder.clipPlane4 ?? secondaryHolder.clipPlane4;\r\n    changed = addDefine(clipPlane, defines, \"CLIPPLANE4\", \"#define CLIPPLANE4\") || changed;\r\n    clipPlane = primaryHolder.clipPlane5 ?? secondaryHolder.clipPlane5;\r\n    changed = addDefine(clipPlane, defines, \"CLIPPLANE5\", \"#define CLIPPLANE5\") || changed;\r\n    clipPlane = primaryHolder.clipPlane6 ?? secondaryHolder.clipPlane6;\r\n    changed = addDefine(clipPlane, defines, \"CLIPPLANE6\", \"#define CLIPPLANE6\") || changed;\r\n    return changed;\r\n}\r\n\r\n/** @internal */\r\nexport function bindClipPlane(effect: Effect, primaryHolder: IClipPlanesHolder, secondaryHolder: IClipPlanesHolder): void {\r\n    let clipPlane = primaryHolder.clipPlane ?? secondaryHolder.clipPlane;\r\n    setClipPlane(effect, \"vClipPlane\", clipPlane);\r\n    clipPlane = primaryHolder.clipPlane2 ?? secondaryHolder.clipPlane2;\r\n    setClipPlane(effect, \"vClipPlane2\", clipPlane);\r\n    clipPlane = primaryHolder.clipPlane3 ?? secondaryHolder.clipPlane3;\r\n    setClipPlane(effect, \"vClipPlane3\", clipPlane);\r\n    clipPlane = primaryHolder.clipPlane4 ?? secondaryHolder.clipPlane4;\r\n    setClipPlane(effect, \"vClipPlane4\", clipPlane);\r\n    clipPlane = primaryHolder.clipPlane5 ?? secondaryHolder.clipPlane5;\r\n    setClipPlane(effect, \"vClipPlane5\", clipPlane);\r\n    clipPlane = primaryHolder.clipPlane6 ?? secondaryHolder.clipPlane6;\r\n    setClipPlane(effect, \"vClipPlane6\", clipPlane);\r\n}\r\n\r\nfunction setClipPlane(effect: Effect, uniformName: string, clipPlane: Nullable<Plane>): void {\r\n    if (clipPlane) {\r\n        effect.setFloat4(uniformName, clipPlane.normal.x, clipPlane.normal.y, clipPlane.normal.z, clipPlane.d);\r\n    }\r\n}\r\n\r\nfunction addDefine(clipPlane: Nullable<Plane>, defines: string[] | Record<string, any>, defineName: string, defineString: string): boolean {\r\n    const defineClipPlane = clipPlane ? true : false;\r\n\r\n    let alreadySet: boolean;\r\n    if (Array.isArray(defines)) {\r\n        const defineIndex = defines.indexOf(defineString);\r\n        alreadySet = defineIndex !== -1;\r\n        if (!alreadySet && clipPlane) {\r\n            defines.push(defineString);\r\n        } else if (alreadySet && !clipPlane) {\r\n            defines.splice(defineIndex, 1);\r\n        }\r\n    } else {\r\n        alreadySet = defines[defineName];\r\n        defines[defineName] = defineClipPlane;\r\n    }\r\n\r\n    const changed = alreadySet !== defineClipPlane;\r\n    return changed;\r\n}\r\n"]}